<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 5 Vocabulary Showcase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .vocab-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .vocab-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); }
        .gemini-output { transition: max-height 0.5s ease-in-out; max-height: 0; overflow: hidden; }
        .loader { width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #a855f7; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 tracking-tight">Unit 5 Vocabulary Showcase</h1>
            <p class="mt-3 text-lg text-gray-600">A visual guide to the key words in "How do we remember THE PAST?". Try the interactive features on each card!</p>
        </header>

        <!-- Museums Section -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold border-b-4 border-purple-500 pb-2 mb-6 text-gray-800">Museums & Artifacts</h2>
            <div id="museums-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Cards injected by JS -->
            </div>
        </section>

        <!-- Mistakes Section -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold border-b-4 border-teal-500 pb-2 mb-6 text-gray-800">Learning from Mistakes</h2>
            <div id="mistakes-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Cards injected by JS -->
            </div>
        </section>

    </div>

    <script>
        const vocabData = {
            museums: [
                { word: 'archaeological find', definition: 'An object from the past discovered by an archaeologist.', imageUrl: 'https://images.unsplash.com/photo-1599930113854-d6d7fd521f10?q=80&w=600&auto=format&fit=crop' },
                { word: 'artifact', definition: 'An object made by a human being, typically one of cultural or historical interest.', imageUrl: 'https://images.unsplash.com/photo-1544208375-77983664d7cf?q=80&w=600&auto=format&fit=crop' },
                { word: 'exhibit', definition: 'A public display of works of art or items of interest, held in a museum or gallery.', imageUrl: 'https://images.unsplash.com/photo-1554907984-15263bfd63bd?q=80&w=600&auto=format&fit=crop' },
                { word: 'excavation', definition: 'The action of digging up something, especially an archaeological site.', imageUrl: 'https://images.unsplash.com/photo-1592388795521-081b2397191d?q=80&w=600&auto=format&fit=crop' },
                { word: 'preservation', definition: 'The action of maintaining something in its original or existing state.', imageUrl: 'https://images.unsplash.com/photo-1505664194779-8beaceb930b4?q=80&w=600&auto=format&fit=crop' },
                { word: 'interpretation', definition: 'The action of explaining the meaning of something.', imageUrl: 'https://images.unsplash.com/photo-1532012197267-da84d127e765?q=80&w=600&auto=format&fit=crop' },
                { word: 'admiration', definition: 'Respect and warm approval.', imageUrl: 'https://images.unsplash.com/photo-1499209974431-271d3830b9d9?q=80&w=600&auto=format&fit=crop' },
                { word: 'civilization', definition: 'The society, culture, and way of life of a particular area.', imageUrl: 'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?q=80&w=600&auto=format&fit=crop' },
                { word: 'dedicate', definition: 'To devote time or effort to a particular task or purpose.', imageUrl: 'https://images.unsplash.com/photo-1517048676732-d65bc937f952?q=80&w=600&auto=format&fit=crop' },
                { word: 'excavate', definition: 'To make a hole by digging; to unearth something.', imageUrl: 'https://images.unsplash.com/photo-1534430480872-3498386e7856?q=80&w=600&auto=format&fit=crop' },
                { word: 'inspection', definition: 'Careful examination or scrutiny.', imageUrl: 'https://images.unsplash.com/photo-1581093450021-4a7360e9a6b5?q=80&w=600&auto=format&fit=crop' },
                { word: 'justification', definition: 'The action of showing something to be right or reasonable.', imageUrl: 'https://images.unsplash.com/photo-1455390582262-044cdead277a?q=80&w=600&auto=format&fit=crop' },
                { word: 'permission', definition: 'Officially allowing someone to do a particular thing.', imageUrl: 'https://images.unsplash.com/photo-1589330694653-4a8b661ac171?q=80&w=600&auto=format&fit=crop' },
                { word: 'preserve', definition: 'To maintain something in its original or existing state.', imageUrl: 'https://images.unsplash.com/photo-1623945190986-7786427357dd?q=80&w=600&auto=format&fit=crop' }
            ],
            mistakes: [
                { word: 'admit', definition: 'To confess to be true, often reluctantly.', imageUrl: 'https://images.unsplash.com/photo-1534234828569-1f96b2707b66?q=80&w=600&auto=format&fit=crop' },
                { word: 'blame', definition: 'To assign responsibility for a fault or wrong.', imageUrl: 'https://images.unsplash.com/photo-1594361487118-f4e2b2288781?q=80&w=600&auto=format&fit=crop' },
                { word: 'consequences', definition: 'The results or effects of an action.', imageUrl: 'https://images.unsplash.com/photo-1508963493749-b409821c0042?q=80&w=600&auto=format&fit=crop' },
                { word: 'get defensive', definition: 'To become angry or anxious when you are criticized.', imageUrl: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?q=80&w=600&auto=format&fit=crop' },
                { word: 'obsess', definition: 'To think and talk about someone or something too much.', imageUrl: 'https://images.unsplash.com/photo-1484517186945-df8151a1a871?q=80&w=600&auto=format&fit=crop' },
                { word: 'responsibility', definition: 'The state of having a duty to deal with something or of having control over someone.', imageUrl: 'https://images.unsplash.com/photo-1491438590914-bc09fcaaf77a?q=80&w=600&auto=format&fit=crop' }
            ]
        };

        function createVocabCard(item) {
            const card = document.createElement('div');
            card.className = 'vocab-card bg-white rounded-xl shadow-md overflow-hidden flex flex-col h-full';
            
            card.innerHTML = `
                <div class="h-48 overflow-hidden bg-gray-200">
                    <img src="${item.imageUrl}" alt="${item.word}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e2e8f0/64748b?text=Image+Not+Found';">
                </div>
                <div class="p-5 flex flex-col flex-grow">
                    <h3 class="text-2xl font-bold capitalize text-gray-800">${item.word}</h3>
                    <p class="text-gray-600 mt-2 text-base leading-relaxed border-b border-gray-100 pb-4">${item.definition}</p>
                    
                    <button class="gemini-btn mt-4 w-full bg-purple-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-purple-700 transition-colors duration-200 flex items-center justify-center gap-2">
                        <span>‚ú® Explain & Example</span>
                    </button>
                    
                    <div class="gemini-output hidden mt-3 bg-purple-50 border border-purple-100 rounded-lg p-4">
                        <div class="loader-container hidden"><div class="loader"></div></div>
                        <div class="content-container text-sm text-gray-800 leading-relaxed"></div>
                    </div>

                    <div class="mt-6 pt-4 border-t border-gray-100 flex-grow flex flex-col">
                        <label class="font-semibold text-gray-700 mb-2 text-sm uppercase tracking-wide">Practice Sentence:</label>
                        <textarea class="sentence-input w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-400 focus:border-teal-400 outline-none text-gray-700 transition-shadow" rows="2" placeholder="Write a sentence using '${item.word}'..."></textarea>
                        
                        <button class="check-sentence-btn mt-3 w-full bg-teal-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-teal-700 transition-colors duration-200 flex items-center justify-center gap-2">
                             <span>üìù Check My Sentence</span>
                        </button>
                        
                        <div class="feedback-output hidden mt-3 bg-teal-50 border border-teal-100 rounded-lg p-4">
                            <div class="loader-container hidden"><div class="loader"></div></div>
                            <div class="content-container text-sm text-gray-800 leading-relaxed"></div>
                        </div>
                    </div>
                </div>
            `;
            return card;
        }

        function populateGrid(gridId, data) {
            const grid = document.getElementById(gridId);
            if(grid){
                data.forEach(item => {
                    grid.appendChild(createVocabCard(item));
                });
            }
        }

        async function callGeminiWithExponentialBackoff(prompt, maxRetries = 5) {
            let delay = 1000;
            const apiKey = ""; // API key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 || response.status >= 500) {
                            if (i === maxRetries - 1) throw new Error(`API call failed with status: ${response.status}`);
                        } else {
                            const errorResult = await response.json();
                            return `Error: ${errorResult.error?.message || 'An unknown error occurred.'}`;
                        }
                    } else {
                        const result = await response.json();
                        if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                            return result.candidates[0].content.parts[0].text;
                        } else {
                            return "Sorry, the model's response was empty.";
                        }
                    }
                } catch (error) {
                    if (i === maxRetries - 1) {
                        console.error("Gemini API call error after max retries:", error);
                        return "Sorry, I couldn't reach the AI service right now. Please try again in a moment.";
                    }
                }
                
                await new Promise(res => setTimeout(res, delay));
                delay *= 2;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateGrid('museums-grid', vocabData.museums);
            populateGrid('mistakes-grid', vocabData.mistakes);

            document.addEventListener('click', async (e) => {
                // Handle "Explain & Example" button
                if (e.target.closest('.gemini-btn')) {
                    const button = e.target.closest('.gemini-btn');
                    const card = button.closest('.vocab-card');
                    const word = card.querySelector('h3').textContent;
                    const definition = card.querySelector('p').textContent;
                    const outputDiv = card.querySelector('.gemini-output');
                    const loader = outputDiv.querySelector('.loader-container');
                    const content = outputDiv.querySelector('.content-container');

                    button.disabled = true;
                    button.classList.add('opacity-50', 'cursor-not-allowed');
                    
                    outputDiv.classList.remove('hidden');
                    loader.classList.remove('hidden');
                    content.innerHTML = ''; 

                    const prompt = `For the vocabulary word "${word}" (definition: "${definition}"), please provide:\n\n1. **New Example:** A creative sentence using the word correctly.\n2. **Simple Explanation:** An explanation of the word suitable for a 10-year-old.\n\nKeep the formatting clean using bold labels.`;

                    const response = await callGeminiWithExponentialBackoff(prompt);
                    
                    const formattedResponse = response
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\n/g, '<br>');

                    content.innerHTML = formattedResponse;
                    loader.classList.add('hidden');

                    button.disabled = false;
                    button.classList.remove('opacity-50', 'cursor-not-allowed');
                }

                // Handle "Check My Sentence" button
                if (e.target.closest('.check-sentence-btn')) {
                    const button = e.target.closest('.check-sentence-btn');
                    const card = button.closest('.vocab-card');
                    const word = card.querySelector('h3').textContent;
                    const definition = card.querySelector('p').textContent;
                    const textarea = card.querySelector('.sentence-input');
                    const studentSentence = textarea.value;
                    const outputDiv = card.querySelector('.feedback-output');
                    const loader = outputDiv.querySelector('.loader-container');
                    const content = outputDiv.querySelector('.content-container');

                    outputDiv.classList.remove('hidden');

                    if (studentSentence.trim() === '') {
                        content.innerHTML = '<span class="text-red-600 font-medium">Please write a sentence first!</span>';
                        return;
                    }

                    button.disabled = true;
                    button.classList.add('opacity-50', 'cursor-not-allowed');
                    
                    loader.classList.remove('hidden');
                    content.innerHTML = '';

                    const prompt = `You are a supportive English teacher. A student is practicing the word "${word}" (meaning: "${definition}").\n\nStudent's sentence: "${studentSentence}"\n\nTask:\n1. Is the word used correctly?\n2. If correct, praise them and explain why it works.\n3. If incorrect, gently explain the mistake and show how to fix it.`;
                    
                    const response = await callGeminiWithExponentialBackoff(prompt);
                    
                    const formattedResponse = response
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\n/g, '<br>');

                    content.innerHTML = formattedResponse;
                    loader.classList.add('hidden');

                    button.disabled = false;
                    button.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            });
        });
    </script>
</body>
</html>
